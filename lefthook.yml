# Lefthook configuration for semantic-cache-mcp
# Install: npm install -g @evilmartians/lefthook && lefthook install
# Or: brew install lefthook && lefthook install

pre-commit:
  parallel: false
  commands:
    ruff-check:
      glob: "*.py"
      run: uv run python -m ruff check src/ tests/ --fix --ignore E501,N806,SIM108,SIM102,F841,B904,B905,UP028,W293,UP040,E402,C416
      stage_fixed: true

    ruff-format:
      glob: "*.py"
      run: uv run python -m ruff format src/ tests/
      stage_fixed: true

    mypy:
      glob: "*.py"
      run: uv run python -m mypy src/ || echo "Mypy found type errors (non-blocking)"
      skip:
        - merge
        - rebase

    bandit:
      glob: "*.py"
      run: uv run python -m bandit -c pyproject.toml -r src/
      skip:
        - merge
        - rebase

pre-push:
  parallel: false
  commands:
    tests:
      run: uv run python -m pytest tests/ -x -q
      skip:
        - merge
        - rebase

    type-check:
      run: uv run python -m mypy src/ || echo "Mypy found type errors (non-blocking)"
      skip:
        - merge
        - rebase

# Skip hooks for certain commit messages
skip_output:
  - meta
  - summary

commit-msg:
  commands:
    conventional-commit:
      run: |
        message=$(cat {1})
        if ! echo "$message" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .+"; then
          echo "Commit message must follow Conventional Commits format:"
          echo "  <type>(<scope>): <description>"
          echo ""
          echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
          echo ""
          echo "Your message: $message"
          exit 1
        fi
